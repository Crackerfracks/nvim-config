**General Autocommand Concepts & Warnings**

| Concept/Warning                         | Description                                                                                                                                                                | [NUMHI] Relevance                                                                                                                                     |
| :-------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Purpose**                             | Execute commands automatically on events like file read/write, buffer/window enter/leave, Vim exit.                                                                        | [NUMHI] Core mechanism for plugin behavior: loading highlights, saving data, UI updates on hover/events.                                              |
| **Power & Side Effects** (`E203`, etc.) | Autocommands are powerful and can have unexpected side effects. Test carefully. Be prepared for errors (e.g., disk full) and potential manual cleanup.                     | [NUMHI] Important to consider for data persistence and error handling, especially when modifying files or external data stores (like sidecar JSON).   |
| **File Reading/Writing Logic**          | For compressed files or special handling, ensure `File*` events mirror `Buf*` events for recovery.                                                                         | [NUMHI] Relevant if implementing advanced features like PDF support (though currently out of scope) or other special file handling.                   |
| **Location**                            | Usually placed in `vimrc` (or plugin files).                                                                                                                               | [NUMHI] NumHi autocommands will be defined within the plugin's Lua modules, typically in a setup or core initialization function.                     |
| **Verbosity for Debugging**             | Use `:set verbose=9` to see autocommands as they execute. For listing, `:verbose autocmd ...` shows where it was last defined.                                             | [NUMHI] Useful for debugging which autocommands are firing and in what order, especially for `CursorHold` or highlight loading/saving logic.          |
| **Script Context**                      | Autocommands defined in a script run in that script's context (relevant for `<SID>`, script-local functions/mappings).                                                     | [NUMHI] Relevant as NumHi will be a Lua plugin; callbacks will have access to the plugin's module scope.                                              |
| **Message Overwriting**                 | Messages from autocommand execution can overwrite previous ones; no hit-enter prompt typically.                                                                            | [NUMHI] Consider for user feedback; `nvim-notify` or other notification systems might be preferred over `echo` for more persistent messages.          |
| **`'eventignore'`**                     | Can be used to ignore events temporarily.                                                                                                                                  | [NUMHI] Might be used internally to prevent recursive triggers, or if a user wants to temporarily disable NumHi features.                             |
| **`Cmd-event`s** (`*Cmd`)               | Special events (e.g., `BufReadCmd`, `BufWriteCmd`) where the autocommand is expected to perform the entire operation (read/write/source). Requires careful implementation. | [NUMHI] Less likely for core NumHi text highlighting, but could be relevant for future advanced integrations (e.g., custom export/import mechanisms). |

**Autocommand Definition, Removal, and Listing**

| Command / Syntax Element  | Description                                                                                                                                                                                                               | Example (Vimscript)                                                         | [NUMHI] Relevance                                                                                                                                               |
| :------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------- | --- | ----------------------------- | -------------------------------------------------------------------------------------------- |
| `:au[tocmd]`              | Define an autocommand.                                                                                                                                                                                                    | `:au BufRead *.txt setl tw=80`                                              | [NUMHI] Foundation for all event-driven logic. Lua equivalent: `vim.api.nvim_create_autocmd()`.                                                                 |
| `[group]`                 | Assigns the autocommand to a named group. If omitted, uses the current group (see `:augroup`).                                                                                                                            | `:au MyGroup BufRead *.md ...`                                              | [NUMHI] Essential for organizing NumHi's autocommands, allowing them to be cleared and redefined safely (e.g., on plugin reload or re-setup).                   |
| `{event}`                 | One or more comma-separated event names (no spaces). Case-insensitive.                                                                                                                                                    | `BufRead,BufNewFile`                                                        | [NUMHI] Specifies when NumHi actions should trigger (e.g., `BufReadPost` for loading, `CursorHold` for hover info).                                             |
| `{aupat}`                 | File pattern(s) to match. Comma-separated. Special patterns like `<buffer>` exist. See "Autocommand Patterns" table.                                                                                                      | `*.lua,*.c`, `/path/to/*.txt`, `<buffer>`                                   | [NUMHI] Usually `*` for general buffer events. `<buffer>` might be used for note buffer specific autocmds.                                                      |
| `[++once]`                | Command executes once, then is removed.                                                                                                                                                                                   | `:au BufRead *.tmp ++once echo "One time only"`                             | [NUMHI] Potentially useful for setup tasks that only need to run once per certain condition.                                                                    |
| `[++nested]`              | Allows autocommands triggered by the command in `{cmd}` to execute. Default is no nesting. Max 10 levels.                                                                                                                 | `:au FileChangedShell *.c ++nested e!`                                      | [NUMHI] Might be needed if a NumHi action (e.g., opening a note window) should trigger other standard autocommands.                                             |
| `{cmd}`                   | The command to execute. For Lua, this is often a Lua callback function.                                                                                                                                                   | `setl spell`, `call MyFunction()`, `lua require('myplugin').do_something()` | [NUMHI] The Lua function that performs the highlight loading, note display, etc.                                                                                |
| `:au[tocmd]!`             | Remove autocommands. Variations: `! [grp] {evt} {pat} {cmd}` (replaces), `! [grp] {evt} {pat}` (removes matching), `! [grp] * {pat}` (all events for pattern), `! [grp] {evt}` (all for event), `! [grp]` (all in group). | `:au! MyGroup BufRead *.txt`, `:au! MyGroup`                                | [NUMHI] Crucial for `setup()`: `augroup NumHiGroup                                                                                                              | au! | ... define NumHi autocmds ... | augroup END`pattern to prevent duplicate definitions.`vim.api.nvim_clear_autocmds()` in Lua. |
| Listing Autocommands      | `:au [grp] {evt} {pat}` (specific), `:au [grp] * {pat}` (all events for pat), `:au [grp] {evt}` (all for event), `:au [grp]` (all).                                                                                       | `:au MyGroup BufRead`, `:au <buffer>`                                       | [NUMHI] Useful for debugging; shows currently active autocommands.                                                                                              |
| Expand rules              | `<sfile>` expands when defined. Others (`%`, `<cword>`, `<afile>`, `<amatch>`) expand at execution.                                                                                                                       | `:au BufNewFile *.html so <sfile>:h/html.vim`                               | [NUMHI] Important for Lua callbacks: arguments like `args.file` or `args.buf` provide this context.                                                             |
| `<buffer>` / `<buffer=N>` | Defines a buffer-local autocommand, attached to a specific buffer.                                                                                                                                                        | `:au CursorHold <buffer> call ShowTooltip()`                                | [NUMHI] Very relevant for attaching behavior to specific buffers, e.g., the note editing buffer might have `BufWriteCmd` or `BufLeave` autocmds specific to it. |

**Autocommand Groups (`:augroup`)**

| Command        | Syntax          | Description                                                                                                              | [NUMHI] Relevance                                                                                            |
| :------------- | :-------------- | :----------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------- | -------- | --- | --------------------------------------------------------- |
| `:aug[roup]`   | `:aug {name}`   | Define the current autocmd group for subsequent `:autocmd` definitions. `END` selects the default group. Case-sensitive. | [NUMHI] Essential: `augroup NumHi                                                                            | autocmd! | ... | augroup END`pattern. Lua:`vim.api.nvim_create_augroup()`. |
| `:aug[roup]!`  | `:aug! {name}`  | Delete the autocmd group `{name}`. Warns if autocommands still use it.                                                   | [NUMHI] Less common directly, but `autocmd!` within a group effectively clears and redefines for that group. |
| `FileExplorer` | (Special group) | If this group exists, Vim assumes editing a directory is possible via a plugin.                                          | [NUMHI] Not directly relevant.                                                                               |

**Autocommand Execution (`:doautocmd`, `:doautoall`)**

| Command        | Syntax                             | Description                                                                                                                                  | Key Options    | [NUMHI] Relevance                                                                                                                         |
| :------------- | :--------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------- | :------------- | :---------------------------------------------------------------------------------------------------------------------------------------- |
| `:do[autocmd]` | `:do[au] [grp] {evt} [fname]`      | Manually apply autocommands for `{event}` (and optionally `[group]`) to the current buffer, matching `[fname]` (default: current file name). | `<nomodeline>` | [NUMHI] Useful for testing/debugging. Could be used if NumHi needs to re-trigger its own or other autocommands under specific conditions. |
| `:doautoa[ll]` | `:doautoa[ll] [grp] {evt} [fname]` | Like `:doautocmd`, but applies to all loaded buffers. Current buffer last. Careful with commands that change buffers/content.                | `<nomodeline>` | [NUMHI] Potentially for a "refresh all highlights in project" type command, but needs careful implementation if data is per-buffer.       |

**Disabling Autocommands**

| Method             | Description                                                                                            | Usage Example             | [NUMHI] Relevance                                                                                                                           |
| :----------------- | :----------------------------------------------------------------------------------------------------- | :------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------ |
| `'eventignore'`    | Option to ignore specified events (e.g., "BufRead,BufWrite") or "all". Restore with `:try/:finally`.   | `set eventignore=BufRead` | [NUMHI] Could be used internally to prevent recursion if a NumHi action might re-trigger the same event.                                    |
| `'eventignorewin'` | Option to disable autocommands indefinitely in a specific window (window/buffer related events only).  | `set eventignorewin=all`  | [NUMHI] Less likely for general use, but might be relevant for very specific UI components if they shouldn't trigger standard NumHi events. |
| `:noa[utocmd]`     | Command modifier. Sets `'eventignore'` to "all" for the duration of the immediately following command. | `:noautocmd w output.txt` | [NUMHI] If NumHi performs an action (like writing to a file) that should NOT trigger other autocommands (including its own).                |

**Autocommand Patterns (`{aupat}`)**

| Pattern Element | Matches                                                                                                             | Example                                           | Notes                                               | [NUMHI] Relevance                                                                                                                |
| :-------------- | :------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------ | :-------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------- |
| `*`             | Any sequence of characters (includes path separators, unlike shell `*`).                                            | `*.txt`, `src/*`                                  | Most common wildcard.                               | [NUMHI] Often used with buffer events (`*`) to apply to all buffers.                                                             |
| `?`             | Any single character.                                                                                               | `file?.log`                                       |                                                     | [NUMHI] Less common for NumHi.                                                                                                   |
| `.`             | Literal dot.                                                                                                        | `.`                                               |                                                     | [NUMHI] Less common.                                                                                                             |
| `~`             | Home directory (if $HOME is defined).                                                                               | `~/.config/nvim/init.lua`                         | Expands when autocommand is defined.                | [NUMHI] Less common for patterns, more for commands.                                                                             |
| `$`             | Environment variables.                                                                                              | `$VIMRUNTIME/doc/*.txt`                           | Expands when autocommand is defined.                | [NUMHI] Less common for patterns.                                                                                                |
| `/`             | Path separator. If present, pattern matches against full path and short name. If absent, matches tail of file name. | `/vim/src/*.c`, `*/include/*`                     | Use `*/` to match a directory name not at the root. | [NUMHI] Usually not needed if matching all buffers (`*`) or using `<buffer>`.                                                    |
| `\`             | Escape character for `*`, `?`, `.`, `~`, `,`, `{`, `}`.                                                             | `\\*.bak`                                         |                                                     | [NUMHI] Less common.                                                                                                             |
| `[]`            | Character set, e.g., `[abc]`, `[^abc]`.                                                                             | `[a-z]*.log`                                      |                                                     | [NUMHI] Less common.                                                                                                             |
| `{}`            | Grouping, like `\(\)` in regex. `,` inside acts as `\|`.                                                            | `{*.c,*.h}`                                       | Same as comma-separated patterns outside.           | [NUMHI] Usually use comma-separated patterns.                                                                                    |
| `,`             | Separates multiple patterns.                                                                                        | `*.txt,*.md`                                      | Equivalent to defining separate autocommands.       | [NUMHI] Useful if targeting multiple specific filetypes, though `*` or `FileType` event are more common for NumHi's use case.    |
| `<buffer>`      | Current buffer (when defining). Stored as `<buffer=N>`.                                                             | `autocmd BufWritePre <buffer> ...`                | For buffer-local autocommands.                      | [NUMHI] **Highly relevant** for notes buffer or any buffer-specific NumHi logic.                                                 |
| `<buffer=N>`    | Buffer number `N`.                                                                                                  | `autocmd BufWritePre <buffer=3> ...`              | For buffer-local autocommands.                      | [NUMHI] As above.                                                                                                                |
| `<buffer=abuf>` | Used inside an executing autocommand to refer to the `<abuf>` buffer.                                               | `au BufNewFile * au CursorHold <buffer=abuf> ...` | For defining buffer-local autocommands dynamically. | [NUMHI] Potentially useful for setting up buffer-local autocommands for newly created NumHi-related buffers (e.g., note editor). |

**Special Variables/Placeholders in Autocommands (Expanded at Execution Time)**

| Placeholder                                     | Expands To                                                                                                                                                                                                                 | Context                                                                                                                      | [NUMHI] Relevance                                                                                                     |
| :---------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------- |
| `<afile>`                                       | File name for the event. For `CmdUndefined`/`FuncUndefined`, the command/function name. For `OptionSet`, where option was set. For `User` events, the argument to `:doautocmd`. For `Syntax`, where syntax option was set. | Most file or buffer related events. `CmdUndefined`, `FuncUndefined`, `OptionSet`, `User`, `Syntax`, `WinClosed` (window-ID). | [NUMHI] In Lua callbacks, this corresponds to `args.file` or `args.match`. Essential for identifying the target file. |
| `<abuf>`                                        | Buffer number for the event.                                                                                                                                                                                               | Most buffer related events. Not for files without a buffer (e.g. `:r file`).                                                 | [NUMHI] In Lua callbacks, `args.buf`. Essential for buffer-specific operations.                                       |
| `<amatch>`                                      | The text that matched `{aupat}`. For `CmdUndefined`/`FuncUndefined`, the command/function name. For `FileType`/`Syntax`/`ColorScheme`, the new value. For `WinClosed` (window-ID).                                         | Events where `{aupat}` is used. `OptionSet` (long option name). `RemoteReply` (serverid). `SpellFileMissing` (language).     | [NUMHI] In Lua callbacks, `args.match`. Useful if the pattern captures specific parts or for generic handlers.        |
| `<sfile>`                                       | Name of the sourced file containing the `:autocmd` line.                                                                                                                                                                   | Expands when the autocommand is defined.                                                                                     | [NUMHI] Less directly relevant for Lua plugins using `require`.                                                       |
| `%`                                             | Current file name (can be used in `{cmd}`).                                                                                                                                                                                | In the `{cmd}` part.                                                                                                         | [NUMHI] Lua callbacks usually get buffer/file info via arguments.                                                     |
| `v:cmdarg`                                      | Holds "++enc=" and "++ff=" arguments for file read/write commands.                                                                                                                                                         | For `*Cmd` events involving file I/O.                                                                                        | [NUMHI] Not directly relevant unless implementing `*Cmd` events.                                                      |
| `v:cmdbang`                                     | 1 if "!" was used in the command that triggered the event, 0 otherwise.                                                                                                                                                    | For `*Cmd` events.                                                                                                           | [NUMHI] Not directly relevant.                                                                                        |
| `v:char`                                        | In `InsertCharPre`, the typed character (can be changed). In `InsertEnter`, set to non-empty to prevent cursor restore.                                                                                                    | `InsertCharPre`, `InsertEnter`.                                                                                              | [NUMHI] Unlikely for core functionality.                                                                              |
| `v:insertmode`                                  | In `InsertChange`, `InsertEnter`, indicates the new/current insert mode (`i`, `r`, `v-r`).                                                                                                                                 | `InsertChange`, `InsertEnter`.                                                                                               | [NUMHI] Unlikely.                                                                                                     |
| `v:event`                                       | Dictionary holding event-specific data.                                                                                                                                                                                    | Many newer events (e.g., `ChanInfo`, `CmdlineEnter`, `CompleteChanged`, `OptionSet`, `TextYankPost`, `WinScrolled`).         | [NUMHI] Crucial for modern event handling in Lua. `args.data` in Lua callbacks often maps to `v:event`.               |
| `v:fcs_reason` / `v:fcs_choice`                 | For `FileChangedShell`: reason for change / action to take.                                                                                                                                                                | `FileChangedShell`.                                                                                                          | [NUMHI] Unlikely.                                                                                                     |
| `v:swapname` / `v:swapchoice` / `v:swapcommand` | For `SwapExists`: swap file name / user choice / command to run.                                                                                                                                                           | `SwapExists`.                                                                                                                | [NUMHI] Unlikely.                                                                                                     |
| `v:dying` / `v:exiting`                         | For `VimLeavePre`, `VimLeave`: abnormal exit reason / exit code.                                                                                                                                                           | `VimLeavePre`, `VimLeave`.                                                                                                   | [NUMHI] Could be useful for robust data saving on exit, handling crashes differently.                                 |

**Autocommand Events (Selected - Key Events and NumHi Relevant)**
_(This is a selection; the full `autocmd.md` lists many more. Focus is on those most likely relevant to plugin development and NumHi)_

| Event Name                | Trigger Description                                                                       | `v:event` Keys / Special Vars                                                                                              | Key Characteristics / Notes                                                                                                                       | [NUMHI] Relevance                                                                                                                                                                                                             |
| :------------------------ | :---------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------ | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `BufAdd`                  | After adding a buffer to buffer list or renaming a listed buffer. Before `BufEnter`.      | `<afile>`, `<abuf>` (target is not current buf)                                                                            |                                                                                                                                                   | [NUMHI] Less direct, `BufEnter` usually more relevant.                                                                                                                                                                        |
| `BufDelete`               | Before deleting a buffer from list. `BufUnload` may be called first.                      | `<afile>`, `<abuf>` (target is not current buf)                                                                            | Do not change to another buffer.                                                                                                                  | [NUMHI] If NumHi needs to clean up data associated with a buffer that's being permanently deleted (not just hidden/unloaded).                                                                                                 |
| `BufEnter`                | After entering a buffer (new or existing). Useful for `ftplugin` like actions.            |                                                                                                                            | After `BufAdd`, `BufReadPost`.                                                                                                                    | [NUMHI] **Highly relevant**. Could be used to ensure UI elements are updated, or if some NumHi state is buffer-specific and needs setup when a buffer is entered (though `BufReadPost` is for initial load).                  |
| `BufHidden`               | Before a buffer becomes hidden (no windows show it, but not unloaded/deleted).            | `<afile>`, `<abuf>` (target is not current buf)                                                                            | Not for `:qa`/`:q`.                                                                                                                               | [NUMHI] If NumHi needs to perform cleanup or state changes when a highlighted buffer is no longer visible but might reappear.                                                                                                 |
| `BufLeave`                | Before leaving to another buffer.                                                         |                                                                                                                            | Not for `:qa`/`:q`.                                                                                                                               | [NUMHI] **Relevant** for the note buffer: could trigger auto-save or cleanup when leaving the note editing window/buffer.                                                                                                     |
| `BufModifiedSet`          | After `'modified'` value of a buffer changed.                                             | `<abuf>` (use `bufnr()`)                                                                                                   |                                                                                                                                                   | [NUMHI] Could trigger auto-save of highlights if configured, or update UI indicators.                                                                                                                                         |
| `BufNewFile`              | When starting to edit a file that doesn't exist.                                          | `<afile>`, `<abuf>`                                                                                                        | Used for skeletons/templates. `'modified'` reset after.                                                                                           | [NUMHI] **Relevant** for initializing highlight storage for a new file. Works alongside `BufReadPost` for existing files.                                                                                                     |
| `BufRead` / `BufReadPost` | After reading file into buffer, before modelines. (`BufRead` is alias for `BufReadPost`). | `<afile>`, `<abuf>`                                                                                                        | `'modified'` reset after (unless set by autocmd). Not for `:read file`.                                                                           | [NUMHI] **Crucial**. Primary event for loading persistent highlights and notes from storage (e.g., sidecar JSON) after file content is available.                                                                             |
| `BufReadCmd`              | Before editing a new buffer; should read the file. `Cmd-event`.                           | `<afile>`, `<abuf>`, `v:cmdarg`, `v:cmdbang`                                                                               | Autocmd takes full responsibility for reading the file.                                                                                           | [NUMHI] Unlikely for core text highlighting.                                                                                                                                                                                  |
| `BufReadPre`              | Before reading file into buffer. Not for non-existent files.                              | `<afile>`, `<abuf>`                                                                                                        | Cannot change current buffer.                                                                                                                     | [NUMHI] Less common than `BufReadPost`. Could be used if setup is needed _before_ file content is loaded (e.g., setting binary mode for special files).                                                                       |
| `BufUnload`               | Before unloading buffer text (memory freed). After `BufWritePost`, before `BufDelete`.    | `<afile>`, `<abuf>` (target is not current buf)                                                                            | Do not switch buffers/windows. Not if `v:dying >= 2`.                                                                                             | [NUMHI] Could be a point to save unsaved highlight data, as the buffer content is about to be lost. `BufWritePre` is usually better for explicit saves.                                                                       |
| `BufWinEnter`             | After a buffer is displayed in a window (loaded or unhidden). After modelines.            | `<afile>`, `<abuf>`                                                                                                        |                                                                                                                                                   | [NUMHI] If NumHi has window-specific UI elements that need to be refreshed when a buffer becomes visible in a window.                                                                                                         |
| `BufWinLeave`             | Before buffer removed from window (if not visible in another).                            | `<afile>`, `<abuf>` (target is not current buf)                                                                            | Not if `v:dying >= 2`.                                                                                                                            | [NUMHI] For cleaning up window-specific UI related to a buffer.                                                                                                                                                               |
| `BufWipeout`              | Before completely deleting a buffer. `BufUnload`/`BufDelete` may be called first.         | `<afile>`, `<abuf>` (target is not current buf)                                                                            | Do not change to another buffer.                                                                                                                  | [NUMHI] Final cleanup for any data associated with a buffer if it's being permanently removed.                                                                                                                                |
| `BufWritePre`             | Before writing whole buffer to file. (`BufWrite` is alias).                               | `<afile>`, `<abuf>`, `'[` and `']` marks set to write range.                                                               |                                                                                                                                                   | [NUMHI] **Crucial**. Primary event for saving highlights and notes to persistent storage (e.g., sidecar JSON) _before_ the buffer is written to disk.                                                                         |
| `BufWriteCmd`             | Before writing whole buffer; should do the writing. `Cmd-event`.                          | `<afile>`, `<abuf>`, `v:cmdarg`, `v:cmdbang`, `'[` and `']` marks.                                                         | Autocmd responsible for write and resetting `'modified'`.                                                                                         | [NUMHI] **Relevant** for the note buffer if it's a scratch buffer and needs custom save logic (e.g., to update the main highlight's metadata instead of writing to a file).                                                   |
| `BufWritePost`            | After writing whole buffer to file.                                                       | `<afile>`, `<abuf>`                                                                                                        | Should undo `BufWritePre` changes if any.                                                                                                         | [NUMHI] Can be used for cleanup after saving, or to trigger other actions post-save (e.g., update status line).                                                                                                               |
| `ColorScheme`             | After loading a color scheme.                                                             | `<afile>` (file where set), `<amatch>` (scheme name)                                                                       |                                                                                                                                                   | [NUMHI] If NumHi needs to adapt its highlight colors or UI if the base colorscheme changes (e.g., recalculate contrast or palette definitions).                                                                               |
| `CursorHold`              | User idle for `'updatetime'` ms in Normal mode.                                           |                                                                                                                            | No interactive commands. Internal key `<CursorHold>`.                                                                                             | [NUMHI] **Essential** for showing highlight information (palette, slot, label, note icon) when the cursor hovers over a highlighted region. `vim.opt.updatetime` is relevant.                                                 |
| `CursorHoldI`             | Like `CursorHold`, but in Insert mode.                                                    |                                                                                                                            | Not when waiting for another key or in `CTRL-X` mode.                                                                                             | [NUMHI] Less likely for core highlighting, but could be used for similar hover info if editing notes inline.                                                                                                                  |
| `CursorMoved`             | After cursor moved in Normal/Visual mode, or line changed.                                |                                                                                                                            | Triggered very often; keep handler fast. Not skippable with `:noautocmd`.                                                                         | [NUMHI] Could be used for more dynamic hover updates if `CursorHold` is too slow/jerky, but performance is critical. `CursorHold` is generally preferred for hover actions to avoid excessive processing.                     |
| `CursorMovedI`            | After cursor moved in Insert mode (not if popup menu visible).                            |                                                                                                                            |                                                                                                                                                   | [NUMHI] Similar to `CursorMoved`.                                                                                                                                                                                             |
| `DirChanged`              | After current directory changed (`:cd`, `:lcd`, `:tcd`, `'autochdir'`).                   | `v:event` {cwd, scope, changed_window}, `<afile>` (new dir)                                                                | Pattern "window", "tabpage", "global", "auto".                                                                                                    | [NUMHI] If highlight storage is relative to project root/current directory, this event could trigger reloading/re-scoping of highlight data.                                                                                  |
| `ExitPre`                 | On `:quit`, `:wq`, `:qall` (that exits Vim), after `QuitPre`.                             |                                                                                                                            | Close non-essential windows. Exiting may still be cancelled.                                                                                      | [NUMHI] Less common than `VimLeavePre`.                                                                                                                                                                                       |
| `FileChangedShell`        | Vim notices file changed on disk since editing started.                                   | `<afile>`, `<abuf>` (target is not current buf), `v:fcs_reason`, `v:fcs_choice` (mutable)                                  | Shell commands, `:checktime`, `FocusGained` can trigger. Prompt for reload normally skipped if autocmd exists. Cannot switch/jump/delete buffers. | [NUMHI] If an external process modifies the file AND the NumHi sidecar data, this could be a trigger to reconcile. Complex.                                                                                                   |
| `FileType`                | When `'filetype'` option has been set.                                                    | `<afile>` (file where set), `<amatch>` (new filetype)                                                                      | Cannot switch windows/buffers.                                                                                                                    | [NUMHI] **Relevant** for the note buffer: to set its filetype to `markdown` (`vim.bo.filetype = "markdown"`) which enables Markdown syntax highlighting and potentially other ftplugins for Markdown.                         |
| `FocusGained`             | Nvim got focus.                                                                           |                                                                                                                            |                                                                                                                                                   | [NUMHI] Could trigger a refresh of highlights if they might have become stale while Nvim was unfocused (e.g., due to external file changes).                                                                                  |
| `FocusLost`               | Nvim lost focus.                                                                          |                                                                                                                            |                                                                                                                                                   | [NUMHI] Could trigger an auto-save of pending highlight changes.                                                                                                                                                              |
| `InsertEnter`             | Just before starting Insert/Replace/Virtual Replace mode.                                 | `v:insertmode`                                                                                                             |                                                                                                                                                   | [NUMHI] Unlikely for core highlighting. Could be relevant for inline note editing features.                                                                                                                                   |
| `InsertLeave`             | Just after leaving Insert mode (not for `i_CTRL-C`).                                      |                                                                                                                            |                                                                                                                                                   | [NUMHI] If inline notes are implemented, this could finalize a note edit.                                                                                                                                                     |
| `ModeChanged`             | After mode changed.                                                                       | `v:event` {old_mode, new_mode}                                                                                             | Pattern `old_mode:new_mode`. Triggered on every minor mode change.                                                                                | [NUMHI] Could be used to change UI elements (e.g., statusline component) based on current mode, or to enable/disable certain NumHi interactions based on mode.                                                                |
| `OptionSet`               | After an option is set.                                                                   | `<amatch>` (long option name), `v:option_type`, `v:option_command`, `v:option_new`, `v:option_old`, etc. `<abuf>` not set. | Non-recursive. Not on startup.                                                                                                                    | [NUMHI] If NumHi's behavior depends on certain Neovim options (e.g., `'updatetime'` for hover, or custom NumHi options), this can be used to react to changes.                                                                |
| `QuitPre`                 | On `:quit`, `:wq`, `:qall`, before deciding to close window or quit Vim.                  |                                                                                                                            | For `:wq`, buffer written before.                                                                                                                 | [NUMHI] Could be used to prompt for saving unsaved highlights if user tries to quit with pending changes.                                                                                                                     |
| `SourcePost`              | After sourcing a Vimscript/Lua file.                                                      | `<afile>` (sourced file name)                                                                                              | Not if sourcing interrupted.                                                                                                                      | [NUMHI] If NumHi loads configuration or data from separate Lua files, this could be used to react after such files are sourced (e.g., by user command).                                                                       |
| `TextChanged`             | After change to text in current buffer (Normal mode). `b:changedtick` updated.            |                                                                                                                            | Not if typeahead/operator pending. Not skippable with `:noautocmd`. Triggered often; keep fast.                                                   | [NUMHI] If highlights need to be adjusted _immediately_ after text changes (e.g., shrinking/expanding due to text deletion/insertion). This is complex and can have performance implications. `extmarks` handle some of this. |
| `TextChangedI`            | Like `TextChanged`, but in Insert mode (not if popup menu visible).                       |                                                                                                                            |                                                                                                                                                   | [NUMHI] As `TextChanged`. Could be very relevant for an S-Reader mode that highlights words as they are "read" or typed.                                                                                                      |
| `TextYankPost`            | After a yank or delete command (not for black hole register or `setreg()`).               | `v:event` {inclusive, operator, regcontents, regname, regtype, visual}, `'[` and `']` marks.                               | Pattern `*`. Non-recursive. Cannot change text.                                                                                                   | [NUMHI] Could be used to automatically tag or add metadata to highlights if the text content is yanked. (Advanced idea).                                                                                                      |
| `User`                    | Not executed automatically. Triggered by `:doautocmd User MyEvent`.                       | `<afile>` (arg to `:doautocmd`), `<amatch>` (event name from pattern)                                                      | For custom plugin events.                                                                                                                         | [NUMHI] Can be used to define custom events within NumHi, allowing other plugins or user commands to interact with NumHi in a structured way (e.g., `:doautocmd User NumHiRefreshHighlights`).                                |
| `VimEnter`                | After all startup, vimrc, -c cmd args, windows created, buffers loaded.                   | `v:vim_did_enter` is set just before.                                                                                      |                                                                                                                                                   | [NUMHI] **Relevant** for one-time plugin initialization that needs Neovim to be fully ready, or loading global NumHi settings/data. `require("numhi").setup()` is often called from init.lua, making this less direct.        |
| `VimLeave`                | Before exiting, after shada file written.                                                 | `v:dying`, `v:exiting`. Not if `v:dying >= 2`.                                                                             |                                                                                                                                                   | [NUMHI] Final chance to save data, less common than `VimLeavePre`.                                                                                                                                                            |
| `VimLeavePre`             | Before exiting, before shada file written.                                                | `v:dying`, `v:exiting`. Not if `v:dying >= 2`.                                                                             | Useful with `*` pattern.                                                                                                                          | [NUMHI] **Relevant** for ensuring all pending highlight and note data is saved before Neovim exits.                                                                                                                           |
| `VimResized`              | After Vim window resized (`'lines'`/`'columns'` changed).                                 |                                                                                                                            |                                                                                                                                                   | [NUMHI] If NumHi has UI elements (like a sidebar or floating windows) whose size/position needs to adapt to Vim's window size.                                                                                                |
| `WinEnter`                | After entering another window (not for first window on startup).                          |                                                                                                                            | If window is for another buffer, `BufEnter` is after `WinEnter`. For split/tab, before file loaded.                                               | [NUMHI] If NumHi displays information in the status line or a dedicated UI window, this event can trigger updates specific to the newly focused window.                                                                       |
| `WinLeave`                | Before leaving a window.                                                                  |                                                                                                                            | If new window is different buffer, `BufLeave` before `WinLeave`.                                                                                  | [NUMHI] As with `WinEnter`, for cleaning up or updating window-specific UI.                                                                                                                                                   |
| `WinClosed`               | When closing a window, before removed from layout.                                        | `<amatch>`, `<afile>` (window-ID). `v:event.winid`                                                                         | Non-recursive.                                                                                                                                    | [NUMHI] If NumHi manages its own windows (e.g., a sidebar or a persistent note window), this is crucial for cleanup.                                                                                                          |
| `WinScrolled`             | After any window in current tab scrolled or resized.                                      | `<amatch>`, `<afile>` (window-ID of first scrolled/resized window). `v:event` {resized, scrolled, ... details}.            | Not skippable with `:noautocmd`. Non-recursive but can re-trigger.                                                                                | [NUMHI] If NumHi floating elements (like tooltips under highlights) need to reposition themselves if the underlying text scrolls.                                                                                             |
| `WinResized`              | After a window in current tab changed width or height.                                    | `<amatch>`, `<afile>` (window-ID). `v:event` {width_old, width_new, ...}.                                                  | Same behavior as `WinScrolled`.                                                                                                                   | [NUMHI] Similar to `WinScrolled`, for repositioning/resizing NumHi UI elements tied to window dimensions.                                                                                                                     |
