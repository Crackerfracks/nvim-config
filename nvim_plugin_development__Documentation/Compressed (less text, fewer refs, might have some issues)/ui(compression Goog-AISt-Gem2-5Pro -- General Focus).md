| UI Area / Component / Event Name               | Description / Purpose                                                                                               | Parameters / Options / Structure                                                                                                                                                                                                                                                                                                                                                                                                                                | Key Behaviors / Notes                                                                                                                                                                                                                                             | NumHi Relevance                                                                                                                                                                                                                                                                                                 |
| ---------------------------------------------- | ------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UI Attachment & Options (`nvim_ui_attach`)** |                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `rgb` (ui-option)                              | Decides the color format for the UI.                                                                                | `true`: (default) 24-bit RGB colors. <br> `false`: Terminal colors (8-bit, max 256).                                                                                                                                                                                                                                                                                                                                                                            | Affects how colors are sent and interpreted by the UI.                                                                                                                                                                                                            | `[NUMHI]` Ensures NumHi's custom palettes are rendered correctly, assuming the UI supports RGB.                                                                                                                                                                                                                 |
| `override` (ui-option)                         | Decides how UI capabilities are resolved if multiple UIs are connected.                                             | `true`: Enable requested UI capabilities, even if not supported by all connected UIs. <br> `false`: (default) Disable UI capabilities not supported by all connected UIs.                                                                                                                                                                                                                                                                                       | Useful for debugging or forcing features in specific UI setups.                                                                                                                                                                                                   |
| `ext_cmdline` (ui-ext-options)                 | Externalize the command line. Nvim sends cmdline content as events; UI renders it.                                  | Event: `cmdline_show`, `cmdline_pos`, etc. (see Cmdline Events section).                                                                                                                                                                                                                                                                                                                                                                                        | UI takes responsibility for displaying the command line.                                                                                                                                                                                                          | `[NUMHI]` Relevant if NumHi needs to interact with or display information in a custom command-line area, or for `vim.ui.input` implementations that might leverage this.                                                                                                                                        |
| `ext_hlstate` (ui-ext-options)                 | Provide detailed semantic highlight state information, not just final attributes. Sets `ext_linegrid` implicitly.   | Adds `info` array to `hl_attr_define` events.                                                                                                                                                                                                                                                                                                                                                                                                                   | Allows UI to understand the _source_ of highlights (syntax, UI group, etc.).                                                                                                                                                                                      | `[NUMHI]` Could be useful for advanced NumHi features that need to differentiate its highlights from syntax highlights, or for debugging.                                                                                                                                                                       |
| `ext_linegrid` (ui-ext-options)                | Use line-based grid events for more efficient text/highlight rendering. Deactivates `ui-grid-old` implicitly.       | Events: `grid_line`, `grid_resize`, etc. (see Grid Events (line-based) section).                                                                                                                                                                                                                                                                                                                                                                                | Recommended for new UIs. More efficient than cell-based `ui-grid-old`.                                                                                                                                                                                            | `[NUMHI]` Fundamental for how NumHi's highlights will be rendered by any modern Neovim UI.                                                                                                                                                                                                                      |
| `ext_messages` (ui-ext-options)                | Externalize messages. Nvim sends message content as events; UI renders them. Sets `ext_linegrid` and `ext_cmdline`. | Events: `msg_show`, `msg_clear`, etc. (see Message/Dialog Events section).                                                                                                                                                                                                                                                                                                                                                                                      | UI takes responsibility for displaying messages, ['cmdheight'] becomes 0.                                                                                                                                                                                         | `[NUMHI]` Highly relevant for NumHi's notifications (palette changes, hover info). `msg_show` event details will be critical.                                                                                                                                                                                   |
| `ext_multigrid` (ui-ext-options)               | Enable per-window grid events. Sets `ext_linegrid` implicitly.                                                      | Events: `win_pos`, `win_float_pos`, etc. (see Multigrid Events section).                                                                                                                                                                                                                                                                                                                                                                                        | Allows UIs to manage windows as separate grids, crucial for floating windows and custom window layouts.                                                                                                                                                           | `[NUMHI]` **CRITICAL.** Essential for implementing NumHi's floating note editor, pickers, S-Reader mode, and potentially a sidebar. `win_float_pos` is key.                                                                                                                                                     |
| `ext_popupmenu` (ui-ext-options)               | Externalize popupmenu (completion) and wildmenu.                                                                    | Events: `popupmenu_show`, `popupmenu_select`, `popupmenu_hide`.                                                                                                                                                                                                                                                                                                                                                                                                 | UI renders the completion/wildmenu.                                                                                                                                                                                                                               | `[NUMHI]` Relevant for NumHi's pickers (e.g., color selection, highlight navigation), potentially using `popupmenu_show`.                                                                                                                                                                                       |
| `ext_tabline` (ui-ext-options)                 | Externalize the tabline.                                                                                            | Event: `tabline_update`.                                                                                                                                                                                                                                                                                                                                                                                                                                        | UI renders the tabline.                                                                                                                                                                                                                                           |
| `ext_termcolors` (ui-ext-options)              | Use external default colors (UI provides them).                                                                     | Affects `default_colors_set` behavior (uses -1 for unset colors).                                                                                                                                                                                                                                                                                                                                                                                               | Useful for TUI implementations to use terminal's built-in defaults.                                                                                                                                                                                               |
| **UI Startup**                                 |                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `nvim --embed`                                 | Starts Nvim in a mode where it pauses before startup for UI attachment.                                             | UI calls `nvim_ui_attach()` to continue. Optional steps: `nvim_get_api_info()`, pre-user-config setup, `VimEnter` autocmd for post-user-config setup.                                                                                                                                                                                                                                                                                                           | Defines the handshake for an external UI to connect to and initialize Nvim.                                                                                                                                                                                       | Less directly relevant for an in-process Lua plugin like NumHi, but provides context on UI lifecycle.                                                                                                                                                                                                           |
| **Global Events**                              |                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `set_title`                                    | Set the window title.                                                                                               | `title`: string.                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `set_icon`                                     | Set the icon (minimized) window title.                                                                              | `icon`: string.                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Can be ignored if windowing system doesn't distinguish.                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                 |
| `mode_info_set`                                | Provides information about all editor modes and their cursor styles.                                                | `cursor_style_enabled`: boolean. <br> `mode_info`: list of mode property maps. Each map: `cursor_shape` ("block", "horizontal", "vertical"), `cell_percentage`, `blinkwait`, `blinkon`, `blinkoff`, `attr_id` (cursor hl_id), `attr_id_lm` (lmap cursor hl_id), `short_name`, `name`.                                                                                                                                                                           | UI uses this to set cursor style based on current mode (from `mode_change`).                                                                                                                                                                                      | `[NUMHI]` Context for mode-dependent behavior. Cursor style itself isn't NumHi's focus, but mode awareness is.                                                                                                                                                                                                  |
| `option_set`                                   | UI-related option changed.                                                                                          | `name`: option name (e.g., 'guifont', 'linespace', 'pumblend', 'termguicolors', "ext\_\*"). <br> `value`: new option value.                                                                                                                                                                                                                                                                                                                                     | Triggered on UI connect and when options change. UI might use these for rendering decisions.                                                                                                                                                                      | `[NUMHI]` `pumblend` might affect NumHi's floating pickers/notes if they are blended. `termguicolors` is crucial for color rendering.                                                                                                                                                                           |
| `mode_change`                                  | Editor mode changed.                                                                                                | `mode`: string (current mode name). <br> `mode_idx`: integer (index into `mode_info_set` array).                                                                                                                                                                                                                                                                                                                                                                | UI changes cursor style based on `mode_idx`.                                                                                                                                                                                                                      | `[NUMHI]` Important for NumHi to know the current mode for context-sensitive actions (e.g. different behavior in normal vs. visual mode for highlighting).                                                                                                                                                      |
| `mouse_on` / `mouse_off`                       | Mouse support enabled/disabled in current mode.                                                                     | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Useful for terminal UIs or embedded scenarios.                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                 |
| `busy_start` / `busy_stop`                     | Nvim is busy / not busy. UI should stop/start rendering the cursor.                                                 | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Misnamed; primarily about cursor rendering, not general busyness.                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                 |
| `suspend`                                      | Nvim received suspend command (e.g. CTRL-Z).                                                                        | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Terminal UIs might suspend themselves. Others can ignore.                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                 |
| `update_menu`                                  | Menu mappings changed.                                                                                              | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `bell` / `visual_bell`                         | Audible or visual bell requested.                                                                                   | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `flush`                                        | Nvim is done redrawing the screen for the current batch.                                                            | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           | UI should display the redrawn parts to the user now. Multiple "redraw" batches can precede a "flush".                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                 |
| **Grid Events (line-based, `ext_linegrid`)**   |                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `grid_resize`                                  | Resize a grid. If new, grid is created.                                                                             | `grid`: integer (grid ID). <br> `width`, `height`: integers (new dimensions).                                                                                                                                                                                                                                                                                                                                                                                   | Grid 1 is the default global grid. `ext_multigrid` enables more grids.                                                                                                                                                                                            | `[NUMHI]` Relevant for floating windows (notes, pickers) which are separate grids.                                                                                                                                                                                                                              |
| `default_colors_set`                           | Sets default foreground, background, special colors.                                                                | `rgb_fg`, `rgb_bg`, `rgb_sp`: integers (RGB color values). <br> `cterm_fg`, `cterm_bg`: integers (256-term color codes).                                                                                                                                                                                                                                                                                                                                        | If `ext_termcolors` is set, -1 is used for unset colors. UI must repaint screen with new background.                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                 |
| `hl_attr_define` (ui-event-hl_attr_define)     | Define a highlight attribute set.                                                                                   | `id`: integer (highlight ID). <br> `rgb_attr`: map (RGB attributes: `foreground`, `background`, `special`, `reverse`, `italic`, `bold`, `strikethrough`, `underline`, `undercurl`, `underdouble`, `underdotted`, `underdashed`, `altfont`, `blend`, `url`). <br> `cterm_attr`: map (cterm attributes). <br> `info`: array (semantic info, if `ext_hlstate` enabled). `info` item: `kind` ("ui", "syntax", "terminal"), `ui_name`, `hi_name`, `id`.              | UI maintains a table mapping `id` to attributes. For absent color keys, use default. Booleans default to false. `id` 0 is default highlight. Nvim may reuse `id`s.                                                                                                | `[NUMHI]` NumHi defines its own highlights via API, but this event shows how Nvim communicates _any_ highlight definition to the UI. The `blend` attribute could be relevant for floating elements. `url` could be used for future features.                                                                    |
| `hl_group_set`                                 | Links a built-in highlight group name to an `hl_id`.                                                                | `name`: string (highlight group name, e.g., "Pmenu"). <br> `hl_id`: integer (ID from `hl_attr_define`).                                                                                                                                                                                                                                                                                                                                                         | Useful for UIs rendering their own elements (e.g., external popupmenu) consistently with Nvim's theming.                                                                                                                                                          | `[NUMHI]` If NumHi creates custom UI elements (e.g. a complex picker), it might use this to style them according to Nvim theme.                                                                                                                                                                                 |
| `grid_line` (ui-event-grid_line)               | Redraw a continuous part of a row on a grid.                                                                        | `grid`: integer (grid ID). <br> `row`: integer. <br> `col_start`: integer. <br> `cells`: array of `[text, ?hl_id, ?repeat]`. `hl_id` defaults to last seen. <br> `wrap`: boolean (line wraps to next row).                                                                                                                                                                                                                                                      | Efficiently updates screen lines. Right cell of double-width char is empty string. Whitespace char repeated covers rest of line if clearing.                                                                                                                      | `[NUMHI]` Core rendering event that displays NumHi's extmark-based highlights on screen.                                                                                                                                                                                                                        |
| `grid_clear`                                   | Clear a grid.                                                                                                       | `grid`: integer (grid ID).                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `grid_destroy`                                 | Grid will no longer be used.                                                                                        | `grid`: integer (grid ID).                                                                                                                                                                                                                                                                                                                                                                                                                                      | UI can free associated data.                                                                                                                                                                                                                                      | `[NUMHI]` Relevant for managing resources if NumHi uses many short-lived floating grids for notes/pickers.                                                                                                                                                                                                      |
| `grid_cursor_goto`                             | Set current grid and cursor position.                                                                               | `grid`: integer (grid ID). <br> `row`, `col`: integers.                                                                                                                                                                                                                                                                                                                                                                                                         | Sent at most once per `redraw` batch. Indicates visible cursor position.                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                 |
| `grid_scroll`                                  | Scroll a region of a grid.                                                                                          | `grid`: integer. <br> `top`, `bot`, `left`, `right`: integers (scroll region boundaries, end-exclusive). <br> `rows`: integer (positive for up, negative for down). <br> `cols`: integer (reserved, currently 0).                                                                                                                                                                                                                                               | Optimized screen copy. Scrolled-in area filled by subsequent `grid_line` events.                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                 |
| **Multigrid Events (`ext_multigrid`)**         |                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `win_pos`                                      | Set position/size of a window grid on the main screen. Shows previously hidden window.                              | `grid`: integer (window's grid ID). <br> `win`: Window object. <br> `start_row`, `start_col`: integers (position on global grid). <br> `width`, `height`: integers (size on global grid).                                                                                                                                                                                                                                                                       | Used for standard window layout.                                                                                                                                                                                                                                  | `[NUMHI]` Could be relevant for a sidebar implementation.                                                                                                                                                                                                                                                       |
| `win_float_pos`                                | Display or reconfigure a floating window.                                                                           | `grid`: integer (float's grid ID). <br> `win`: Window object. <br> `anchor`: string ('NW', 'NE', 'SW', 'SE', or 'cursor', 'mouse'). <br> `anchor_grid`: integer (grid ID to anchor to). <br> `anchor_row`, `anchor_col`: float. <br> `mouse_enabled`: boolean. <br> `zindex`: integer (stacking order hint). <br> `compindex`: integer (exact rendering order). <br> `screen_row`, `screen_col`: float (alternative absolute screen position if not anchoring). | Two positioning modes: relative to `anchor_grid` (manual, UI ensures fit) or Nvim-determined absolute `screen_row/col`. `zindex` for layering hint, `compindex` for precise render order. Render non-float, then floats by `compindex`. Blend layers by `zindex`. | `[NUMHI]` **CRITICAL.** Key for NumHi's floating note editor and pickers. `anchor`, `anchor_grid`, `anchor_row/col` allow precise placement (e.g. "underneath highlight"). `zindex` and `compindex` for proper layering over text/other UI. `mouse_enabled` if pickers should be clickable.                     |
| `win_external_pos`                             | Display or reconfigure an external window (separate top-level OS window).                                           | `grid`: integer. <br> `win`: Window object.                                                                                                                                                                                                                                                                                                                                                                                                                     | For UIs that can create OS-level windows.                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                 |
| `win_hide`                                     | Stop displaying a window (can be shown later).                                                                      | `grid`: integer.                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                   | `[NUMHI]` For temporarily hiding notes/pickers.                                                                                                                                                                                                                                                                 |
| `win_close`                                    | Close a window.                                                                                                     | `grid`: integer.                                                                                                                                                                                                                                                                                                                                                                                                                                                | Grid is typically destroyed afterwards.                                                                                                                                                                                                                           | `[NUMHI]` For closing note editor/pickers.                                                                                                                                                                                                                                                                      |
| `msg_set_pos`                                  | Display messages on a dedicated message grid. Not sent if `ext_messages` is active.                                 | `grid`: integer (message grid ID). <br> `row`: integer (position on default grid). <br> `scrolled`: boolean (message area scrolled over other grids). <br> `sep_char`: string (separator char for [hl-MsgSeparator]). <br> `zindex`: integer (fixed at 200). <br> `compindex`: integer (rendering order).                                                                                                                                                       | Covers full column width of default grid.                                                                                                                                                                                                                         | If `ext_messages` isn't used by another UI, this is how Nvim positions its internal message area. NumHi would likely use `msg_show` events if `ext_messages` is active, or `vim.notify` which may use its own floating windows.                                                                                 |
| `win_viewport`                                 | Indicates buffer text range displayed in a window and cursor position.                                              | `grid`, `win`, `topline`, `botline` (1 past end if filler lines), `curline`, `curcol`, `line_count` (all 0-based), `scroll_delta` (displayed lines scrolled since last event).                                                                                                                                                                                                                                                                                  | Grid updates in batch affect new viewport even if `win_viewport` is received after. Important for smooth scrolling.                                                                                                                                               | `[NUMHI]` Useful for context if NumHi needs to know what part of a buffer is visible, e.g., for optimizing highlight application or for S-Reader.                                                                                                                                                               |
| `win_viewport_margins`                         | Indicates margins of a window grid NOT part of the viewport (e.g., 'winbar', float borders).                        | `grid`, `win`, `top`, `bottom`, `left`, `right` (margin sizes).                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   | `[NUMHI]` Could be relevant for precise positioning of NumHi's floating elements relative to actual text content, avoiding overlap with winbars etc.                                                                                                                                                            |
| `win_extmark`                                  | Updates visible position of a `ui_watched` extmark in a window.                                                     | `grid`, `win`, `ns_id`, `mark_id`, `row`, `col`.                                                                                                                                                                                                                                                                                                                                                                                                                | Only for extmarks with `ui_watched = true`.                                                                                                                                                                                                                       | `[NUMHI]` If NumHi needs very precise UI feedback based on its extmark positions beyond standard highlighting (e.g., custom widgets attached to highlights).                                                                                                                                                    |
| **Popupmenu Events (`ext_popupmenu`)**         |                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `popupmenu_show`                               | Show popupmenu (completion/wildmenu).                                                                               | `items`: array of `[word, kind, menu, info]` (see [complete-items]). <br> `selected`: integer (0-based index, -1 if none). <br> `row`, `col`: integers (anchor position for first char of completed word). <br> `grid`: integer (grid for anchor; -1 if anchored to external cmdline, then `col` is byte pos).                                                                                                                                                  | UI decides presentation (vertical/horizontal).                                                                                                                                                                                                                    | `[NUMHI]` Suitable for NumHi's pickers (category names, colors, highlight navigation) if a simple list-based UI is sufficient. `row`, `col`, `grid` for positioning.                                                                                                                                            |
| `popupmenu_select`                             | Select an item in the current popupmenu.                                                                            | `selected`: integer (0-based index, -1 if none).                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                   | `[NUMHI]` For interactivity within NumHi's pickers.                                                                                                                                                                                                                                                             |
| `popupmenu_hide`                               | Hide the popupmenu.                                                                                                 | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                   | `[NUMHI]` For closing NumHi's pickers.                                                                                                                                                                                                                                                                          |
| **Tabline Events (`ext_tabline`)**             |                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `tabline_update`                               | Tabline was updated.                                                                                                | `curtab`: Tabpage object. <br> `tabs`: list of `{tab: Tabpage, name: string}`. <br> `curbuf`: Buffer object. <br> `buffers`: list of `{buffer: Buffer, name: string}`.                                                                                                                                                                                                                                                                                          | UI presents this in a custom tabline widget.                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                 |
| **Cmdline Events (`ext_cmdline`)**             |                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `cmdline_show`                                 | Cmdline displayed or changed.                                                                                       | `content`: list of `[attrs, string]` chunks. <br> `pos`: integer (cursor position). <br> `firstc`: string (e.g., ':', '/'). <br> `prompt`: string (input() prompt). <br> `indent`: integer (spaces). <br> `level`: integer (recursion level). <br> `hl_id`: integer (hl_id for prompt).                                                                                                                                                                         | `level` distinguishes nested cmdlines.                                                                                                                                                                                                                            | `[NUMHI]` Relevant if NumHi uses `vim.ui.input()` and the UI externalizes the cmdline; NumHi would rely on the UI to render the prompt.                                                                                                                                                                         |
| `cmdline_pos`                                  | Change cursor position in cmdline.                                                                                  | `pos`: integer. <br> `level`: integer.                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `cmdline_special_char`                         | Display special char in cmdline (e.g., for CTRL-V).                                                                 | `c`: string (char to display). <br> `shift`: boolean (true to shift text, false to overwrite). <br> `level`: integer.                                                                                                                                                                                                                                                                                                                                           | Hidden at next `cmdline_show`.                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                 |
| `cmdline_hide`                                 | Hide the cmdline.                                                                                                   | `level`: integer. <br> `abort`: boolean (true if aborted).                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `cmdline_block_show`                           | Show block of context for current cmdline (e.g. function definition).                                               | `lines`: list of lines, each line is a list of `[attrs, string]` chunks.                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `cmdline_block_append`                         | Append line to current cmdline block.                                                                               | `line`: list of `[attrs, string]` chunks.                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `cmdline_block_hide`                           | Hide cmdline block.                                                                                                 | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| **Message/Dialog Events (`ext_messages`)**     |                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `msg_show`                                     | Display a message to the user.                                                                                      | `kind`: string (message type, e.g., "confirm", "emsg", "echo", "search_count", "undo"). <br> `content`: array of `[attr_id, text_chunk, hl_id]` tuples. <br> `replace_last`: boolean (true to replace most recent msg_show). <br> `history`: boolean (true if added to :messages). <br> `append`: boolean (true to append to previous message, e.g., for :echon).                                                                                               | `content` chunks build the message, can contain `\n`. UI should treat unknown `kind` as empty.                                                                                                                                                                    | `[NUMHI]` **CRITICAL.** This is how Nvim sends messages if `ext_messages` is on. NumHi's notifications (echo line updates on hover, palette change popups) would likely use this or an equivalent (`vim.notify()`). `kind` helps categorize. `replace_last` useful for transient info. `content` for rich text. |
| `msg_clear`                                    | Clear messages displayed by `msg_show`.                                                                             | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Does not affect `msg_showmode`, `msg_showcmd`, `msg_ruler`.                                                                                                                                                                                                       | `[NUMHI]` To clear previous NumHi notifications.                                                                                                                                                                                                                                                                |
| `msg_showmode`                                 | Shows ['showmode'] and [recording] messages.                                                                        | `content`: array of `[attr_id, text_chunk, hl_id]`. Empty `content` hides last message.                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `msg_showcmd`                                  | Shows ['showcmd'] messages.                                                                                         | `content`: array of `[attr_id, text_chunk, hl_id]`. Empty `content` hides last message.                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `msg_ruler`                                    | Used for ['ruler'] when no statusline space.                                                                        | `content`: array of `[attr_id, text_chunk, hl_id]`. Empty `content` hides last message.                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `msg_history_show`                             | Sent when `:messages` is invoked.                                                                                   | `entries`: list of `[kind, content]` tuples.                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |
| `msg_history_clear`                            | Clear `:messages` history.                                                                                          | None.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                 |

**Note on Grid Events (cell-based, `ui-grid-old`):**
The `ui.md` document describes these as legacy and recommends `ui-linegrid` for new UIs. For brevity and focus on modern plugin development, I've detailed `ui-linegrid` above. The cell-based events (`resize`, `clear`, `eol_clear`, `cursor_goto`, `update_fg/bg/sp`, `highlight_set`, `put`, `set_scroll_region`, `scroll`) offer a more granular, per-cell update model which is generally less efficient. If detailed information on `ui-grid-old` is crucial, it can be added, but `ext_linegrid` is the primary target for modern UIs.

```

```
